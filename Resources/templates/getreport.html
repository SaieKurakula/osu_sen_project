{% extends "base.html" %}

<!--{% import "macros/forms.html" as forms %}-->

{% block title %}Business Intelligence Report{% endblock %}

{% block head %}
    {{ parent() }}
    <style type="text/css">
        .important { color: #336699; }
    </style>

{% endblock %}

{% block content %}
	<div>
		<h1>Business Intelligence Report</h1>
	</div>
	<br />

<html>
	<head>
			<!--Load jQuery-->
		<!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>-->
			<!--Load the Google JS API-->
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
		<script type="text/javascript">
			// Load the Visualization API and the piechart package.
		google.load('current', {'packages':['corechart']});
			// Set a callback to run when the Google Visualization API is loaded.
      google.setOnLoadCallback(drawChart);
			// Callback that creates and populates a data table,
			// instantiates the pie chart, passes in the data and
			// draws it.
      function drawChart() {
			// Create the data table
		var data = google.visualization.arrayToDataTable([
		['Region', 'Awards'],
		<?php
		$query = 'SELECT region_name, COUNT(award_record.award_record_ID) AS award_count FROM region INNER JOIN award_record ON region.region_ID=award_record.reg_ID GROUP BY region_name';
		$result = $this->DB->execute($query);
		while($row = mysqli_fetch_array($result)){
		echo "['".$row['region_name']."',".$row['award_count']."],";
		}
		?>
		]);
		//var jsonData = $.ajax({url: "getData.php",dataType:"json",async: false}).responseText;
                   
			// Create the data table out of JSON data loaded from server.
		//var data = new google.visualization.DataTable(jsonData);
               
			// Set chart options
		var options = {
		title: 'Awards by Region'
		};
 
        // Instantiate and draw our chart, passing in some options.
		var chart = new google.visualization.ColumnChart(document.getElementById('columnchart'));
		chart.draw(data, options);
      }
		</script>
	</head>
	<!--<div>
		{{ forms.blank() }}
	</div>-->

{% endblock %}